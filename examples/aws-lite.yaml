---
clouds:
  aws:
    region: "us-east-2"
    vpc_network: 10.0.0.0/16
    ssh_key_path: "~/.ssh/id_rsa.pub"

    outputs:
      - web.ip
      - data.ip

    security_groups:
      - web_sec:
          - from: all
            port: 80
            protocol: tcp
          - from: all
            port: 443
            protocol: tcp
      - ping_sec:
          - from: all
            protocol: icmp
      - database_sec:
          - from: web_server
            port: 3306
            protocol: tcp
          - from: web_server
            port: 5432
            protocol: tcp
      - bastion_sec:
          - from: all
            port: 22
            protocol: tcp

    servers:
      - server: web_server
        os: centos-7
        size: t2.micro
        count: 3
        remote_command:
          - sudo yum install -y docker
          - sudo systemctl start docker
          - sudo systemctl enable docker
          - sudo docker run -d --name web -p 80:80 nginx
        external_access:
          - http
          - https
          - ssh
          - ping
        network: 10.0.0.0/24
        elastic: true
        tags:
          "Server Role": "Web-server"
          OS: "CentOS-7"

      - server: database
        os: ubuntu-20.04
        size: t2.micro
        count: 1
        remote_command:
          - sudo apt-get update
          - sudo apt-get install -y apache2
          - sudo systemctl start apache2
          - sudo systemctl enable apache2
        external_access: no
        security_groups:
          - database_sec
        network: 10.0.2.0/24
        network_type: private
        elastic: false

      # - server: database
      #   os: centos-8
      #   size: t2.micro
      #   key: /path/to/key
      #   count: 1
      #   run_command:
      #     - sudo apt-get update && sudo apt-get install postgresql
      #   external_access: false
      #   network: 10.0.1.0/24
      #   elastic: false
